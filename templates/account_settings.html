{% extends "layout.html" %}

{% block content %}
<div class="container" style="max-width: 600px; margin-top: 40px;">
    <div style="margin-bottom: 30px;">
        <a href="{{ url_for('admin_panel') if current_user.is_admin else url_for('dashboard') }}" style="color: var(--text-muted); font-weight: 600;">
            <i class="fas fa-arrow-left"></i> Back
        </a>
    </div>
    
    <h1 style="margin-bottom: 30px;">Account Settings</h1>
    
    <div class="card">
        <h3 style="margin-bottom: 20px;">Change Password</h3>
        <form method="POST" action="/change_password">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            
            {% if current_user.password_hash %}
            <label>Current Password</label>
            <input type="password" name="current_password" placeholder="Enter current password" required>
            {% endif %}
            
            <label>New Password</label>
            <input type="password" name="new_password" placeholder="Enter new password" required 
                   minlength="6">
            
            <label>Confirm New Password</label>
            <input type="password" name="confirm_password" placeholder="Confirm new password" required>
            
            <button type="submit" class="btn btn-primary" style="margin-top: 20px; width: 100%;">
                Update Password
            </button>
        </form>
    </div>
    
    <div class="card">
        <h3 style="margin-bottom: 20px;">Account Information</h3>
        <form method="POST" action="/update_account_info">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            
            <div style="margin-bottom: 15px;">
                <label>Email</label>
                <input type="email" value="{{ current_user.email }}" disabled 
                       style="background: #f8fafc; color: var(--text-muted);">
                <small style="color: var(--text-muted); font-size: 0.85rem;">Email cannot be changed</small>
            </div>
            
            <div style="margin-bottom: 15px;">
                <label>Full Name</label>
                <input type="text" name="full_name" value="{{ current_user.full_name or '' }}" 
                       placeholder="Enter your full name">
                <small style="color: var(--text-muted); font-size: 0.85rem;">This name will be used for payouts and communications</small>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label>Phone Number</label>
                <input type="tel" name="phone" value="{{ current_user.phone or '' }}" 
                       placeholder="555-123-4567"
                       pattern="[0-9]{3}[-.\s]?[0-9]{3}[-.\s]?[0-9]{4}|\([0-9]{3}\)\s?[0-9]{3}[-.\s]?[0-9]{4}|^$"
                       title="Please enter a valid 10-digit US phone number (e.g. 555-123-4567), or leave blank to clear">
                <small style="color: var(--text-muted); font-size: 0.85rem;">We'll text or call when we're on our way for pickup</small>
            </div>
            
            <button type="submit" class="btn btn-primary" style="width: 100%;">
                Save Changes
            </button>
        </form>
    </div>

    <div class="card">
        <h3 style="margin-bottom: 20px;"><i class="fas fa-map-marker-alt" style="color: var(--primary);"></i> Pickup Location</h3>
        <p style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 20px;">Where should we pick up your items? We'll text you when we're on our way.</p>
        {% set standalone = true %}
        {% include 'dashboard_pickup_form.html' %}
    </div>

    {% if current_user.payout_handle %}
    <div class="card">
        <h3 style="margin-bottom: 20px;"><i class="fas fa-wallet" style="color: var(--primary);"></i> Payout Info</h3>
        <p style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 15px;">
            <strong>{{ current_user.payout_method }}</strong> @{{ current_user.payout_handle }}
        </p>
        <form action="/update_payout" method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 15px; margin-bottom: 15px;">
                <div>
                    <label style="margin-top: 0;">Method</label>
                    <select name="payout_method">
                        <option value="Venmo" {% if current_user.payout_method == 'Venmo' %}selected{% endif %}>Venmo</option>
                        <option value="Zelle" {% if current_user.payout_method == 'Zelle' %}selected{% endif %}>Zelle</option>
                        <option value="PayPal" {% if current_user.payout_method == 'PayPal' %}selected{% endif %}>PayPal</option>
                    </select>
                </div>
                <div>
                    <label style="margin-top: 0;">Handle</label>
                    <div style="display: flex; align-items: center; border: 1px solid #cbd5e1; border-radius: 8px; overflow: hidden;">
                        <span style="background: #f1f5f9; padding: 12px 15px; font-weight: 700; color: var(--text-muted);">@</span>
                        <input type="text" name="payout_handle" value="{{ current_user.payout_handle }}" style="border: none; flex: 1;" required>
                    </div>
                </div>
            </div>
            <button type="submit" class="btn btn-primary">Update Payout</button>
        </form>
    </div>
    {% endif %}

    {% if current_user.is_admin %}
    <div class="card" style="background: #f0fdf4; border-color: #bbf7d0;">
        <div style="display: flex; align-items: center; gap: 10px;">
            <i class="fas fa-shield-alt" style="color: #166534;"></i>
            <strong style="color: #166534;">Admin Account</strong>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
