{% extends "layout.html" %}

{% block body_class %}seller-page{% endblock %}

{% block content %}
<style>
    /* --- SELLER PAGE: Light theme - matches rest of site --- */
    .seller-section {
        max-width: 800px;
        margin: 0 auto 64px;
        padding: 0 20px;
    }
    .seller-section h2 {
        font-size: 1.6rem;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 12px;
        color: var(--text-main);
    }
    .seller-section h2 i {
        color: var(--accent);
    }
    .seller-section p {
        color: var(--text-muted);
    }
    
    
    /* Pricing section - light accent strip */
    .payment-structure-section {
        background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(251, 191, 36, 0.05) 100%);
        border: 1px solid rgba(245, 158, 11, 0.25);
        color: var(--text-main);
        padding: 64px 32px;
        margin: 64px 0;
    }
    .payment-structure-section h2 {
        color: var(--text-main);
        text-align: center;
        margin-bottom: 12px;
    }
    .payment-structure-section .subhead {
        text-align: center;
        color: var(--text-muted);
        font-size: 1.05rem;
        max-width: 560px;
        margin-left: auto;
        margin-right: auto;
        line-height: 1.6;
    }
    
    .timeline-seller .timeline-step { margin-bottom: 40px; }
    .why-fee-link {
        display: inline-block;
        font-size: 0.85rem;
        color: var(--accent);
        margin-top: 8px;
        text-decoration: none;
        font-weight: 600;
    }
    .why-fee-link:hover { text-decoration: underline; }
    
    .seller-page #join.card {
        background: var(--card-bg);
        border: var(--card-border);
        color: var(--text-main);
    }
    .seller-page #join h2,
    .seller-page #join .fa-handshake {
        color: var(--text-main);
    }
    .seller-page #join .fa-handshake {
        color: var(--accent) !important;
    }
    .seller-page #join p {
        color: var(--text-muted);
    }
    .seller-page #join input {
        background: rgba(255, 255, 255, 0.8);
        border: 1px solid #cbd5e1;
        color: var(--text-main);
    }
    .seller-page #join input::placeholder {
        color: var(--text-muted);
    }
    .seller-page #join a {
        color: var(--accent);
    }
    
    /* FAQ accordion */
    .faq-accordion {
        display: flex;
        flex-direction: column;
        gap: 0;
    }
    .faq-item {
        border-bottom: 1px solid #e2e8f0;
    }
    .faq-item:first-child {
        border-top: 1px solid #e2e8f0;
    }
    .faq-item summary {
        padding: 18px 0;
        font-size: 1.05rem;
        font-weight: 600;
        color: var(--text-main);
        cursor: pointer;
        list-style: none;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .faq-item summary::-webkit-details-marker { display: none; }
    .faq-item summary::after {
        content: '+';
        font-size: 1.2rem;
        color: var(--accent);
        font-weight: 400;
    }
    .faq-item[open] summary::after {
        content: 'âˆ’';
    }
    .faq-item p {
        padding: 0 0 18px;
        margin: 0;
        font-size: 0.95rem;
        line-height: 1.6;
        color: var(--text-muted);
    }
    
    /* Interactive Room - hero (first, biggest section) */
    .interactive-room-hero {
        max-width: 1200px;
        margin: 0 auto;
        padding: 32px 20px 48px;
    }
    .interactive-room {
        background: var(--card-bg);
        border: var(--card-border);
        border-radius: 24px;
        padding: 40px;
        margin: 0 0 48px;
        box-shadow: var(--glass-shadow);
    }
    .interactive-room-headline {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 12px;
        margin-bottom: 12px;
        text-align: center;
    }
    .interactive-room-headline .headline-text {
        font-size: 1.5rem;
        font-weight: 800;
        color: var(--text-main);
        line-height: 1.35;
        max-width: 100%;
        word-wrap: break-word;
    }
    .interactive-room-headline .profit-row {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
    }
    .interactive-room-headline .profit-label {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--text-muted);
    }
    .interactive-room-headline .total-amount {
        font-size: 4.5rem;
        font-weight: 900;
        color: var(--primary);
        letter-spacing: -0.02em;
        line-height: 1;
        transition: transform 0.2s ease;
    }
    .interactive-room-headline .total-amount.pop {
        animation: amountPop 0.4s ease;
    }
    @keyframes amountPop {
        0% { transform: scale(1); }
        50% { transform: scale(1.15); }
        100% { transform: scale(1); }
    }
    .interactive-room .tagline {
        text-align: center;
        color: var(--text-muted);
        margin-bottom: 24px;
        font-size: 1rem;
    }
    .room-image-container {
        position: relative;
        max-width: 100%;
        margin: 0 auto 24px;
        border-radius: 16px;
        overflow: hidden;
    }
    .room-image-container img {
        display: block;
        width: 100%;
        height: auto;
    }
    .room-svg-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
    }
    .room-svg-overlay polygon {
        pointer-events: auto;
        fill: transparent;
        cursor: pointer;
        transition: fill 0.2s ease;
    }
    .room-svg-overlay polygon:hover {
        fill: rgba(6, 78, 59, 0.4);
    }
    .room-svg-overlay polygon.receipt-active {
        fill: rgba(6, 78, 59, 0.25);
    }
    .room-tooltip {
        position: absolute;
        top: 16px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(15, 23, 42, 0.9);
        color: white;
        padding: 10px 16px;
        border-radius: 10px;
        font-size: 0.95rem;
        font-weight: 600;
        white-space: nowrap;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.2s, visibility 0.2s;
        z-index: 10;
        pointer-events: none;
    }
    .room-tooltip.visible {
        opacity: 1;
        visibility: visible;
    }
    .room-receipt {
        background: #f8fafc;
        border: 1px solid #e2e8f0;
        border-radius: 16px;
        padding: 24px;
    }
    .room-receipt h3 {
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--text-main);
        margin: 0 0 16px;
    }
    .room-receipt-list {
        list-style: none;
        margin: 0 0 16px;
        padding: 0;
    }
    .room-receipt-list li {
        display: grid;
        grid-template-columns: 1fr 90px 90px;
        gap: 16px;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid #e2e8f0;
        font-size: 0.95rem;
        color: var(--text-main);
    }
    .room-receipt-list li > span:nth-child(2),
    .room-receipt-list li > span:nth-child(3) {
        text-align: right;
    }
    .room-receipt-list li:last-child {
        border-bottom: none;
    }
    .room-receipt-list li.room-receipt-header {
        font-weight: 700;
        color: var(--text-muted);
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        padding-bottom: 12px;
        margin-bottom: 4px;
        border-bottom: 2px solid #e2e8f0;
    }
    .room-receipt-total {
        font-size: 1.25rem;
        font-weight: 800;
        color: var(--primary);
        padding-top: 12px;
        border-top: 2px solid var(--primary);
    }
    .room-receipt-empty {
        color: var(--text-muted);
        font-size: 0.95rem;
        padding: 12px 0;
        grid-column: 1 / -1;
    }
    
    @media (max-width: 768px) {
        .interactive-room-headline .headline-text { font-size: 1.25rem; }
        .interactive-room-headline .profit-label { font-size: 1.1rem; }
        .interactive-room-headline .total-amount { font-size: 3rem; }
    }
</style>

<div class="seller-page">
    <div class="container">
        <!-- Start Selling CTA - first thing under header -->
        <div class="reveal fade-up" style="text-align: center; margin-top: 4px; margin-bottom: 8px;">
            <a href="{{ url_for('onboard') }}" class="btn btn-primary" style="padding: 18px 48px; font-size: 1.25rem; display: inline-block;">Start Selling <i class="fas fa-arrow-right"></i></a>
        </div>
        <!-- Interactive Room - Hero (calculator) -->
        <div class="interactive-room-hero reveal fade-up">
            <div class="interactive-room">
                <h2 class="interactive-room-headline"><span class="headline-text">See how much your room could make with Campus Swap</span><span class="profit-row"><span class="profit-label">Your profit:</span><span class="total-amount" id="room-total">$0</span></span></h2>
                <p class="tagline">Hover over items to see value. Click to add or remove from your potential earnings.</p>
                <div class="room-image-container" id="room-container">
                    <div class="room-tooltip" id="room-tooltip"></div>
                    <img src="{{ url_for('static', filename='dormRoom.png') }}" alt="Dorm room sketch" id="room-image">
                    <svg class="room-svg-overlay" id="room-svg" viewBox="0 0 2816 1536" preserveAspectRatio="xMidYMid meet">
                        <polygon data-item="minifridge" data-value="55" data-label="Mini-fridge" points="2162,698 2032,761 2032,997 2169,1057 2291,990 2291,756"></polygon>
                        <polygon data-item="rug" data-value="40" data-label="Rug" points="1306,1141 1410,1194 1662,1064 1662,965 1674,950 1244,753 1045,850 1281,965 1291,985 1291,1002 1291,1022 1296,1037 1306,1047"></polygon>
                        <polygon data-item="rug" data-value="40" data-label="Rug" points="1269,1124 1269,1087 1236,1107"></polygon>
                        <polygon data-item="microwave" data-value="25" data-label="Microwave" points="1291,422 1289,509 1371,546 1490,489 1490,402 1408,365 1353,395"></polygon>
                        <polygon data-item="headboard" data-value="40" data-label="Headboard" points="547,936 562,926 562,864 624,831 612,809 702,759 764,739 796,754 826,749 823,607 806,597 527,722 527,924"></polygon>
                        <polygon data-item="mattress" data-value="80" data-label="Mattress" points="567,931 1022,1163 1042,1165 1057,1158 1085,1145 1281,1043 1291,1016 1284,981 1276,963 965,812 908,779 893,779 823,749 796,754 823,782 828,797 816,807 764,831 716,854 689,864 662,854 637,839 622,831 567,859 562,871"></polygon>
                        <polygon data-item="couch" data-value="70" data-label="Couch" points="1689,846 1694,886 1707,889 1709,854 1726,861 1836,807 1838,819 1851,817 1853,794 1881,779 1878,687 1861,677 1868,615 1846,600 1809,583 1774,568 1739,553 1719,550 1704,538 1667,523 1619,503 1595,495 1572,495 1560,505 1547,553 1413,617 1410,627 1408,717 1438,727 1445,772 1455,769 1460,734 1445,772 1460,737"></polygon>
                        <polygon data-item="acunit" data-value="50" data-label="AC Unit" points="1938,592 2065,645 2087,637 2090,535 1963,483 1948,490 1935,525"></polygon>
                        <polygon data-item="tv" data-value="90" data-label="TV" points="1664,963 1662,1133 1672,1138 1794,1080 1796,1090 1744,1120 1779,1138 1883,1080 1846,1061 1831,1070 1826,1061 1930,1003 1930,834 1920,829"></polygon>
                    </svg>
                </div>
                <div class="room-receipt">
                    <h3>Potential Earnings Receipt</h3>
                    <ul class="room-receipt-list" id="room-receipt-list"></ul>
                    <div class="room-receipt-total" id="room-receipt-total">Total: $0</div>
                </div>
            </div>
        </div>

        <!-- How It Works -->
        <div class="timeline-section timeline-seller reveal fade-up">
            <div style="text-align: center; margin-bottom: 50px;">
                <h2>How It Works</h2>
                <p style="color: rgba(255, 255, 255, 0.9); max-width: 480px; margin: 12px auto 0;">From signup to payout, we&rsquo;ve got you.</p>
            </div>
            <div class="timeline-inner" style="position: relative; max-width: 800px; margin: 0 auto;">
                <div class="timeline-line"></div>
                <div class="timeline-step" style="display: flex; align-items: center; margin-bottom: 50px;">
                    <div class="timeline-step-text" style="flex: 1; text-align: right; padding-right: 30px;">
                        <div class="step-date">Step 1</div>
                        <h3>Sign Up</h3>
                        <p>Create your account and add your pickup address. No charge yet.</p>
                    </div>
                    <div class="step-icon"><i class="fas fa-user-plus"></i></div>
                    <div style="flex: 1;"></div>
                </div>
                <div class="timeline-step" style="display: flex; align-items: center; margin-bottom: 50px;">
                    <div style="flex: 1;"></div>
                    <div class="step-icon"><i class="fas fa-camera"></i></div>
                    <div class="timeline-step-text" style="flex: 1; padding-left: 30px;">
                        <div class="step-date">Within 1 day</div>
                        <h3>Items Approved</h3>
                        <p>Upload photos and details. We review and approve items that meet our criteria.</p>
                    </div>
                </div>
                <div class="timeline-step" style="display: flex; align-items: center; margin-bottom: 50px;">
                    <div class="timeline-step-text" style="flex: 1; text-align: right; padding-right: 30px;">
                        <div class="step-date">Before pickup</div>
                        <h3>Add Card</h3>
                        <p>Add your card now. You won&rsquo;t be charged until pickup week. Fee: $15 service + $10 per large item (we mark during approval).</p>
                        <a href="#why-fee" class="why-fee-link">Why do we charge a fee?</a>
                    </div>
                    <div class="step-icon"><i class="fas fa-credit-card"></i></div>
                    <div style="flex: 1;"></div>
                </div>
                <div class="timeline-step" style="display: flex; align-items: center; margin-bottom: 50px;">
                    <div style="flex: 1;"></div>
                    <div class="step-icon"><i class="fas fa-truck"></i></div>
                    <div class="timeline-step-text" style="flex: 1; padding-left: 30px;">
                        <div class="step-date">May</div>
                        <h3>Pickup</h3>
                        <p>We schedule by area. You get a window; someone must be home. We text before we arrive.</p>
                    </div>
                </div>
                <div class="timeline-step" style="display: flex; align-items: center;">
                    <div class="timeline-step-text" style="flex: 1; text-align: right; padding-right: 30px;">
                        <div class="step-date">Summer</div>
                        <h3>Get Paid</h3>
                        <p>Your items are stored and sold at our <strong>retail store near campus</strong> June 1-Aug 31. Buyers browse in person. {{ store_info.address }}. You receive <strong style="color: var(--accent);">50%</strong> of the sale price via Venmo or Zelle when yours sells. Add your payout info in your dashboard; we process within a few days.</p>
                    </div>
                    <div class="step-icon"><i class="fas fa-money-bill-wave"></i></div>
                    <div style="flex: 1;"></div>
                </div>
            </div>
        </div>

    </div>

        <!-- Why We Charge a Fee (full width) -->
        <div id="why-fee" class="payment-structure-section reveal fade-up">
            <h2><i class="fas fa-info-circle"></i> Pricing &amp; Why We Charge</h2>
            <p class="subhead"><strong>$15 service fee</strong> (covers 1 oversized item) guarantees your space in our store and our move-out pickup service. <strong>$10 per additional oversized item</strong> (we mark during approval). You add your card now. We charge only at pickup for approved items. In-person drop-offs have no fee but earn 33% vs. 50%.</p>
        </div>

    <div class="container">
        <!-- FAQ -->
        <div class="seller-section reveal fade-up" id="faq">
            <h2><i class="fas fa-question-circle"></i> Seller FAQ</h2>
            <div class="faq-accordion">
                <details class="faq-item">
                    <summary>What items can I sell?</summary>
                    <p>Larger items that typically sell for ~$50+: couches, mini fridges, mattresses, futons, AC units, TVs. No small or low-value items.</p>
                </details>
                <details class="faq-item">
                    <summary>When will you pick up my items?</summary>
                    <p>We organize pickups by area during move-out. You&rsquo;ll get an email 1-2 days before with your window. We&rsquo;ll text or call 30-60 minutes before we arrive.</p>
                </details>
                <details class="faq-item">
                    <summary>Do I need to be home for pickup?</summary>
                    <p>Yes. Someone must be home to let our team in. We&rsquo;ll contact you before we arrive.</p>
                </details>
                <details class="faq-item">
                    <summary>What if I&rsquo;m not home when you arrive?</summary>
                    <p>We&rsquo;ll call you. If you can&rsquo;t get home quickly, we&rsquo;ll try to reschedule once within the pickup period.</p>
                </details>
            </div>
        </div>

        <!-- CTA -->
        <div id="join" class="card no-hover reveal fade-up" style="text-align: center; padding: 60px; max-width: 640px; margin: 0 auto 80px;">
            <div style="margin-bottom: 30px;">
                <i class="fas fa-handshake" style="font-size: 2.5rem; color: var(--primary); margin-bottom: 16px;"></i>
                <h2 style="font-size: 2rem; margin-bottom: 12px;">Ready to start selling?</h2>
                <p style="font-size: 1.05rem;">
                    Create your account and get started.
                </p>
            </div>
            <a href="{{ url_for('login') }}" class="btn btn-primary" style="padding: 16px 40px; font-size: 1.1rem; display: inline-block;">
                Start Selling
            </a>
            <p style="margin-top: 20px; font-size: 0.9rem;">New here? <a href="{{ url_for('register') }}" style="color: var(--accent); font-weight: bold;">Create Account</a></p>
        </div>
    </div>
</div>

<script>
    const observer = new IntersectionObserver(entries => {
        entries.forEach(entry => { if(entry.isIntersecting) entry.target.classList.add('active'); });
    });
    document.querySelectorAll('.reveal').forEach(el => observer.observe(el));

    // Interactive Room - coordinate data (reference; polygons in SVG are source of truth)
    const ROOM_ITEMS = {
        minifridge: { points: "2162,698 2032,761 2032,997 2169,1057 2291,990 2291,756", value: 55, label: "Mini-fridge" },
        rug:        { value: 40, label: "Rug" },
        microwave:  { points: "1291,422 1289,509 1371,546 1490,489 1490,402 1408,365 1353,395", value: 25, label: "Microwave" },
        headboard:  { points: "547,936 562,926 562,864 624,831 612,809 702,759 764,739 796,754 826,749 823,607 806,597 527,722 527,924", value: 40, label: "Headboard" },
        mattress:   { points: "567,931 1022,1163 1042,1165 1057,1158 1085,1145 1281,1043 1291,1016 1284,981 1276,963 965,812 908,779 893,779 823,749 796,754 823,782 828,797 816,807 764,831 716,854 689,864 662,854 637,839 622,831 567,859 562,871", value: 80, label: "Mattress" },
        couch:      { points: "1689,846 1694,886 1707,889 1709,854 1726,861 1836,807 1838,819 1851,817 1853,794 1881,779 1878,687 1861,677 1868,615 1846,600 1809,583 1774,568 1739,553 1719,550 1704,538 1667,523 1619,503 1595,495 1572,495 1560,505 1547,553 1413,617 1410,627 1408,717 1438,727 1445,772 1455,769 1460,734 1445,772 1460,737", value: 70, label: "Couch" },
        acunit:     { points: "1938,592 2065,645 2087,637 2090,535 1963,483 1948,490 1935,525", value: 50, label: "AC Unit" },
        tv:         { points: "1664,963 1662,1133 1672,1138 1794,1080 1796,1090 1744,1120 1779,1138 1883,1080 1846,1061 1831,1070 1826,1061 1930,1003 1930,834 1920,829", value: 90, label: "TV" }
    };

    const receiptItems = [];
    let lastTotal = -1;
    const tooltipEl = document.getElementById('room-tooltip');
    const totalEl = document.getElementById('room-total');
    const receiptListEl = document.getElementById('room-receipt-list');
    const receiptTotalEl = document.getElementById('room-receipt-total');
    const polygons = document.querySelectorAll('#room-svg polygon');

    function formatLabel(label) {
        return label === 'acunit' ? 'AC Unit' : label.charAt(0).toUpperCase() + label.slice(1);
    }

    function updateReceipt() {
        const total = receiptItems.reduce((sum, it) => sum + it.value, 0);
        totalEl.textContent = '$' + total;
        if (total !== lastTotal && lastTotal >= 0) {
            totalEl.classList.add('pop');
            totalEl.addEventListener('animationend', () => totalEl.classList.remove('pop'), { once: true });
        }
        lastTotal = total;
        receiptTotalEl.textContent = total > 0 ? 'Total Potential Earnings: $' + total : 'Total Potential Earnings:';

        if (receiptItems.length === 0) {
            receiptListEl.innerHTML = '<li class="room-receipt-empty">Click items above to add to your receipt</li>';
        } else {
            const header = '<li class="room-receipt-header"><span>Item</span><span>Sale Price</span><span>Your Profit</span></li>';
            const rows = receiptItems.map(it => {
                const salePrice = it.value * 2;
                return '<li><span>' + it.label + '</span><span>$' + salePrice + '</span><span>$' + it.value + '</span></li>';
            }).join('');
            receiptListEl.innerHTML = header + rows;
        }

        polygons.forEach(p => {
            const id = p.dataset.item;
            const inReceipt = receiptItems.some(it => it.id === id);
            p.classList.toggle('receipt-active', inReceipt);
        });
    }

    polygons.forEach(polygon => {
        polygon.addEventListener('mouseenter', function() {
            const label = this.dataset.label || formatLabel(this.dataset.item);
            const value = parseInt(this.dataset.value, 10);
            tooltipEl.textContent = label + ': $' + value;
            tooltipEl.classList.add('visible');
        });
        polygon.addEventListener('mouseleave', function() {
            tooltipEl.classList.remove('visible');
        });
        polygon.addEventListener('click', function() {
            const id = this.dataset.item;
            const label = this.dataset.label || formatLabel(id);
            const value = parseInt(this.dataset.value, 10);
            const idx = receiptItems.findIndex(it => it.id === id);
            if (idx >= 0) {
                receiptItems.splice(idx, 1);
            } else {
                receiptItems.push({ id, label, value });
            }
            updateReceipt();
        });
    });

    updateReceipt();
</script>
{% endblock %}
